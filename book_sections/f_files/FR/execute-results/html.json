{
  "hash": "9466c6095f6c4eca303498d5c57d5d33",
  "result": {
    "engine": "knitr",
    "markdown": "## •  18. F and anova in R  {.unnumbered  #FR}\n\n\n\n::: {.cell}\n\n:::\n\n\n::: {.motivation style=\"background-color: #ffe6f7; padding: 10px; border: 1px solid #ddd; border-radius: 5px;\"}\n\n\n\n**Motivating Scenario:**  Now that you know what goes into calculating the sums of squares, degrees of freedom, mean squares, and F, you can want R to do this all for you. Here, we run an ANOVA in R and learn how to read the results it gives back.\n\n\n**Learning Goals: By the end of this subchapter, you should be able to:**. \n\n- Run a one-way ANOVA in R using both `aov() |> summary()` and `lm() |> anova()` pipelines.  \n\n- Interpret the ANOVA table which includes sums of squares, mean squares, F statistic, and p-value.\n\n\n- Use the `broom` package to:    \n    - `tidy()` ANOVA results and \n    - `glance()` at  model-level summaries (like $R^2$).\n\n:::\n\n---\n\nIn the previous sections we worked through the math and the theory, and even how we could use R to do our calculations for us. This is all useful and I hope it helps you understand what is going on behind the scenes. But now that we know what's going on, we can have R do our work for us. Here, I show you two ways to have R calculate F and conduct an anova test for us. \n\nIn so doing we consider how to interpret R's output, and how to convert it to a \"tidy\" format with `broom`'s `glance()` and `tidy()` functions.\n\n## The `aov() |> summary()` pipeline\n\nThe [`aov()`](https://stat.ethz.ch/R-manual/R-devel/RHOME/library/stats/html/aov.html) function is built specifically to conduct ANOVA in R. To do so, it uses the familiar   formula syntax: `(RESPONSE ~ EXPLANATORY, data = DATA)` \n\n\n\n::: {.cell .column-margin layout-align=\"center\"}\n::: {.cell-output-display}\n![](../../figs/linear_models/F/aov.png){fig-align='center' width=95%}\n:::\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nadmix_anova <- aov(admix_proportion ~ petal_color, data= clarkia_hz )\n```\n:::\n\n\nThe [`aov()`](https://stat.ethz.ch/R-manual/R-devel/RHOME/library/stats/html/aov.html) object contains the relevant sums of squares (which match our hand calculations!) and the degrees of freedom. To actually view the [ANOVA table](https://online.stat.psu.edu/stat415/lesson/13/13.2), we use [`summary()`](https://stat.ethz.ch/R-manual/R-devel/library/base/html/summary.html) on the aov object. This table includes the sums of squares, mean squares, the F statistic, and the associated p-value.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(admix_anova)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            Df   Sum Sq   Mean Sq F value   Pr(>F)    \npetal_color  1 0.001831 0.0018312   76.54 3.49e-11 ***\nResiduals   44 0.001053 0.0000239                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n27 observations deleted due to missingness\n```\n\n\n:::\n:::\n\n\n---\n\n\n`broom`'s `tidy()` function provides this output in a \"tidy\" format, its `glance()`  function shows some relevant summaries of the model (including $R^2$).\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(broom)\ntidy(admix_anova)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 6\n  term           df   sumsq    meansq statistic   p.value\n  <chr>       <dbl>   <dbl>     <dbl>     <dbl>     <dbl>\n1 petal_color     1 0.00183 0.00183        76.5  3.49e-11\n2 Residuals      44 0.00105 0.0000239      NA   NA       \n```\n\n\n:::\n\n```{.r .cell-code}\nglance(admix_anova)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 6\n  logLik   AIC   BIC deviance  nobs r.squared\n   <dbl> <dbl> <dbl>    <dbl> <int>     <dbl>\n1   180. -355. -349.  0.00105    46     0.635\n```\n\n\n:::\n:::\n\n\n\n## The `lm() |> anova()` pipeline\n\nAlternatively, we can fit a linear model and then hand it to [`anova()`](https://stat.ethz.ch/R-manual/R-devel/RHOME/library/stats/html/anova.html)\n to create the ANOVA table. This produces the same output as `aov() |> summary()`, but the intermediate object is an lm object rather than an aov object. Sometimes one format is just easier to work with than the other, but your results will be the same.\n \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlm(admix_proportion ~ petal_color, data= clarkia_hz ) |>\n  anova()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: admix_proportion\n            Df    Sum Sq    Mean Sq F value    Pr(>F)    \npetal_color  1 0.0018312 0.00183122  76.539 3.486e-11 ***\nResiduals   44 0.0010527 0.00002393                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n--- \n\nIf we want more information about our model, we can pass the lm object to [`glance()`](https://broom.tidymodels.org/reference/glance.lm.html):\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlm(admix_proportion ~ petal_color, data= clarkia_hz ) |>\n  glance()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 12\n  r.squared adj.r.squared   sigma statistic  p.value    df logLik   AIC   BIC\n      <dbl>         <dbl>   <dbl>     <dbl>    <dbl> <dbl>  <dbl> <dbl> <dbl>\n1     0.635         0.627 0.00489      76.5 3.49e-11     1   180. -355. -349.\n# ℹ 3 more variables: deviance <dbl>, df.residual <int>, nobs <int>\n```\n\n\n:::\n:::\n\n\n:::aside\n`glance()` works on model objects like `lm` or `aov`, but not on the ANOVA table itself. So `lm() |> anova() |> glance()` returns an empty tibble.\n::: \n\n---\n\n::: note\n\n**Here is a brief summary of common linear model workflows in R  and what they give us.** \n\n| Task                 | Function(s)           | Output object                              |\n| -------------------- | --------------------- | ------------------------------------------ |\n| Run ANOVA directly   | `aov() |> summary()` | ANOVA table                                |\n| Run via linear model | `lm() |> anova()`    | same ANOVA table, but model object is `lm` |\n| Tidy results         | `broom::tidy()`       | tidy table of terms                        |\n| Model summary        | `broom::glance()`     | includes R², df, etc.                      |\n\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}